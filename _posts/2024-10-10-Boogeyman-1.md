---
layout: post
title: Boogeyman 1
subtitle: Phishing Email Investigation
comments: true
author: Ren Sie
---

{: .box-success}
 Refer to [Boogeyman1](https://tryhackme.com/room/boogeyman1) for the challenge room

### Artefacts
For the investigation, you will be provided with the following artefacts: 
- Copy of the phishing email (`dump.eml`) 
- PowerShell logs from Julianne's workstation (`powershell.json`) 
- Packet capture from the same workstation (`capture.pcapng`) 
Note: The `powershell.json` file contains JSON-formatted PowerShell logs extracted from its original EVTX file using the evtx2json tool. 
  You can find these files in the /home/ubuntu/Desktop/artefacts. 

### Tools 
The provided VM includes the following tools for investigation: 
- Thunderbird: A free and open-source cross-platform email client. 
- LNKParse3: A Python package for analyzing binary files with LNK extensions. 
- Wireshark: A GUI-based packet analyzer. 
- Tshark: The CLI version of Wireshark. 
- jq: A lightweight and flexible command-line JSON processor.

Additionally, user can utilize built-in command-line tools for effective parsing and analysis of the artefacts:
- grep
- sed
- awk
- base64 

### [Email Analysis] Look at that headers! 
Julianne, a finance employee at Quick Logistics LLC, received a follow-up email about an unpaid invoice from their business partner, B Packaging Inc.
Unbeknownst to her, the attached document was malicious and compromised her workstation.  
>Hi Julianne,  
>I hope you are well.  
>I just wanted to drop you a quick note to remind you in respect of document #39586972 is due for payment on January 20, 2023.  
>I would be grateful if you could confirm everything is on track for payment.  
>For additional information, kindly see the attached document.  
>  
>You may use this code to view the encrypted file: Invoice2023!  
>  
>Best regards,  
>Arthur Griffin  
>Collections Officer  
>B Packaging Inc.  
>  
>E: agriffin@bpackaging[.]xyz  
>W: https[://]bpackaging[.]xyz  

The security team flagged the suspicious execution of the attachment, alongside phishing reports from other finance department employees, indicating a targeted attack on the finance team. Recent trends show that the initial TTP used for the malicious attachment is linked to a new threat group called Boogeyman, known for targeting the logistics sector. 


#### Investigation Guide 
Given the initial information, we know the compromise began with a phishing email. Let's start by analyzing the **_dump.eml_** file located in the artefacts directory. There are two methods to analyze the headers and rebuild the attachment: 

- **Manual Method**: Use command-line tools such as cat, grep, base64, and sed. You can manually analyze the contents and build the attachment by decoding the string located at the bottom of the file. 
~~~
$ echo # sample command to rebuild the payload, presuming the encoded payload is written in another file, without all line terminators 
$ cat *PAYLOAD FILE* | base64 -d > Invoice.zip 
~~~
- **Automated Method**: Double-click the EML file to open it in Thunderbird. From there, you can save and extract the attachment. Once the payload from the encrypted archive is extracted, use LNKParse3 to analyze the information contained within the payload.
~~~
$ lnkparse *LNK FILE* 
~~~

#### Questions & Answers
1. What is the email address used to send the phishing email?  
  Once we opened the **_dump.eml_** with Thunderbird, we will be able to retrieve some basic information
  > From:	Arthur Griffin **_<agriffin@bpakcaging[.]xyz>_**  
  > Reply-To:	Arthur Griffin <agriffin@bpakcaging[.]xyz>  
  > To:	Julianne Westcott **_<julianne.westcott@hotmail[.]com>_**  
  > Subject:	Collection for Quick Logistics LLC - Jan 2023  
  > Date:	Fri, 13 Jan 2023 09:25:26 +0000
2. What is the email address of the victim?  
  Refer to the previous answer.
3. What is the name of the third-party mail relay service used by the attacker based on the DKIM-Signature and List-Unsubscribe headers?  
  We can identify the email relay service provider in the DKIM-Signature within the source code.
  > DKIM-Signature: v=1; a=rsa-sha256; **_d=elasticemail.com_**; s=api;  
  > c=relaxed/simple; t=1673601926;  
  > h=from:date:subject:reply-to:to:list-unsubscribe;
{: .box-note}
**Note:** The 'd=' tag specifies the domain that is responsible for signing the email. This domain is typically the organization or entity that sent the email, and it is used to verify the authenticity of the email's sender.
4. What is the name of the file inside the encrypted attachment?  
 - Save the attachment **Invoice.zip** from the mail
 - After entering the password (Invoice2023!) and extracting the content, we can learn the file name **Invoice_20230103.lnk**.  
{: .box-warning}
**Warning:** Do not execute the extracted file.
5. What is the password of the encrypted attachment?
   Refer to the Email content for the password







**Here is some bold text**

## Here is a secondary heading

[This is a link to a different site](https://deanattali.com/) and [this is a link to a section inside this page](#local-urls).

Here's a table:

| Number | Next number | Previous number |
| :------ |:--- | :--- |
| Five | Six | Four |
| Ten | Eleven | Nine |
| Seven | Eight | Six |
| Two | Three | One |

You can use [MathJax](https://www.mathjax.org/) to write LaTeX expressions. For example:
When \\(a \ne 0\\), there are two solutions to \\(ax^2 + bx + c = 0\\) and they are $$x = {-b \pm \sqrt{b^2-4ac} \over 2a}.$$

How about a yummy crepe?

![Crepe](https://beautifuljekyll.com/assets/img/crepe.jpg)

It can also be centered!

![Crepe](https://beautifuljekyll.com/assets/img/crepe.jpg){: .mx-auto.d-block :}

Here's a code chunk:

~~~
var foo = function(x) {
  return(x + 5);
}
foo(3)
~~~

And here is the same code with syntax highlighting:

```javascript
var foo = function(x) {
  return(x + 5);
}
foo(3)
```

And here is the same code yet again but with line numbers:

{% highlight javascript linenos %}
var foo = function(x) {
  return(x + 5);
}
foo(3)
{% endhighlight %}

## Boxes
You can add notification, warning and error boxes like this:

### Notification

{: .box-note}
**Note:** This is a notification box.

### Warning

{: .box-warning}
**Warning:** This is a warning box.

### Error

{: .box-error}
**Error:** This is an error box.

## Local URLs in project sites {#local-urls}

When hosting a *project site* on GitHub Pages (for example, `https://USERNAME.github.io/MyProject`), URLs that begin with `/` and refer to local files may not work correctly due to how the root URL (`/`) is interpreted by GitHub Pages. You can read more about it [in the FAQ](https://beautifuljekyll.com/faq/#links-in-project-page). To demonstrate the issue, the following local image will be broken **if your site is a project site:**

![Crepe](/assets/img/crepe.jpg)

If the above image is broken, then you'll need to follow the instructions [in the FAQ](https://beautifuljekyll.com/faq/#links-in-project-page). Here is proof that it can be fixed:

![Crepe]({{ '/assets/img/crepe.jpg' | relative_url }})

<details markdown="1">
<summary>Click here!</summary>
Here you can see an **expandable** section
</details>
